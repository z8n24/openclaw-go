<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Go - Control Panel</title>
    <style>
        :root {
            --bg: #0f0f0f;
            --card: #1a1a1a;
            --border: #333;
            --text: #e5e5e5;
            --muted: #888;
            --accent: #e44d26;
            --success: #22c55e;
            --warning: #eab308;
            --error: #ef4444;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .logo {
            font-size: 32px;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .version {
            background: var(--card);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: var(--muted);
        }
        
        .status-badge {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .status-badge.online {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }
        
        .status-badge.offline {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .stat:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: var(--muted);
        }
        
        .stat-value {
            font-weight: 500;
        }
        
        .channel-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .channel-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
        }
        
        .channel-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .channel-icon.telegram { background: #2aabee20; }
        .channel-icon.discord { background: #5865f220; }
        .channel-icon.whatsapp { background: #25d36620; }
        .channel-icon.webchat { background: #e44d2620; }
        
        .channel-info {
            flex: 1;
        }
        
        .channel-name {
            font-weight: 500;
        }
        
        .channel-status {
            font-size: 12px;
            color: var(--muted);
        }
        
        .sessions-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .session-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }
        
        .session-item:last-child {
            border-bottom: none;
        }
        
        .session-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .session-info {
            flex: 1;
            min-width: 0;
        }
        
        .session-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .session-meta {
            font-size: 12px;
            color: var(--muted);
        }
        
        .logs-container {
            background: #000;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Menlo', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .log-line {
            display: flex;
            gap: 10px;
        }
        
        .log-time {
            color: var(--muted);
            flex-shrink: 0;
        }
        
        .log-level {
            flex-shrink: 0;
            width: 50px;
        }
        
        .log-level.info { color: #3b82f6; }
        .log-level.warn { color: var(--warning); }
        .log-level.error { color: var(--error); }
        
        .log-msg {
            color: var(--text);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: var(--muted);
            font-size: 14px;
        }
        
        footer a {
            color: var(--accent);
            text-decoration: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <span class="logo">ü¶û</span>
            <h1>OpenClaw Go</h1>
            <span class="version" id="version">v0.1.0</span>
            <div class="status-badge online" id="status-badge">
                <span class="status-dot"></span>
                <span id="status-text">Connected</span>
            </div>
        </header>
        
        <div class="grid">
            <!-- Gateway Stats -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üìä Gateway</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Uptime</span>
                    <span class="stat-value" id="uptime">-</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Protocol</span>
                    <span class="stat-value" id="protocol">3</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Clients</span>
                    <span class="stat-value" id="clients">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Sessions</span>
                    <span class="stat-value" id="sessions">0</span>
                </div>
            </div>
            
            <!-- Channels -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üì± Channels</span>
                </div>
                <div class="channel-list" id="channels">
                    <div class="channel-item">
                        <div class="channel-icon webchat">üí¨</div>
                        <div class="channel-info">
                            <div class="channel-name">WebChat</div>
                            <div class="channel-status">Ready</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Cron Jobs -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">‚è∞ Cron Jobs</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Total Jobs</span>
                    <span class="stat-value" id="cron-total">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Enabled</span>
                    <span class="stat-value" id="cron-enabled">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Next Run</span>
                    <span class="stat-value" id="cron-next">-</span>
                </div>
            </div>
            
            <!-- Skills -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üéØ Skills</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Loaded</span>
                    <span class="stat-value" id="skills-total">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Enabled</span>
                    <span class="stat-value" id="skills-enabled">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Tools</span>
                    <span class="stat-value" id="skills-tools">0</span>
                </div>
            </div>
        </div>
        
        <!-- Active Sessions -->
        <div class="card" style="margin-bottom: 20px;">
            <div class="card-header">
                <span class="card-title">üí¨ Active Sessions</span>
            </div>
            <div class="sessions-list" id="sessions-list">
                <div class="session-item">
                    <div class="session-avatar">M</div>
                    <div class="session-info">
                        <div class="session-name">main</div>
                        <div class="session-meta">No activity yet</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Logs -->
        <div class="card">
            <div class="card-header">
                <span class="card-title">üìú Recent Logs</span>
            </div>
            <div class="logs-container" id="logs">
                <div class="log-line">
                    <span class="log-time">--:--:--</span>
                    <span class="log-level info">INFO</span>
                    <span class="log-msg">Waiting for connection...</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>OpenClaw Go ‚Ä¢ <a href="https://github.com/openclaw/openclaw-go">GitHub</a> ‚Ä¢ <a href="https://docs.openclaw.ai">Docs</a></p>
        </footer>
    </div>
    
    <script>
        const API_BASE = window.location.origin;
        let ws = null;
        let reconnectTimer = null;
        
        // Êõ¥Êñ∞Áä∂ÊÄÅ
        async function updateStatus() {
            try {
                const res = await fetch(`${API_BASE}/api/status`);
                const data = await res.json();
                
                document.getElementById('version').textContent = `v${data.version || '0.1.0'}`;
                document.getElementById('protocol').textContent = data.protocol || '3';
                document.getElementById('clients').textContent = data.clients || '0';
                
                setOnline(true);
            } catch (e) {
                setOnline(false);
            }
        }
        
        function setOnline(online) {
            const badge = document.getElementById('status-badge');
            const text = document.getElementById('status-text');
            
            if (online) {
                badge.className = 'status-badge online';
                text.textContent = 'Connected';
            } else {
                badge.className = 'status-badge offline';
                text.textContent = 'Disconnected';
            }
        }
        
        function addLog(level, msg) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            
            const line = document.createElement('div');
            line.className = 'log-line';
            line.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="log-level ${level.toLowerCase()}">${level}</span>
                <span class="log-msg">${msg}</span>
            `;
            
            logs.appendChild(line);
            logs.scrollTop = logs.scrollHeight;
            
            // ‰øùÁïôÊúÄËøë 100 Êù°
            while (logs.children.length > 100) {
                logs.removeChild(logs.firstChild);
            }
        }
        
        function connectWebSocket() {
            const wsUrl = `ws://${window.location.host}/ws`;
            
            try {
                ws = new WebSocket(wsUrl);
                
                ws.onopen = () => {
                    addLog('INFO', 'WebSocket connected');
                    // ÂèëÈÄÅ hello
                    ws.send(JSON.stringify({
                        client: { id: 'control-ui', mode: 'readonly' },
                        minProtocol: 3
                    }));
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        handleMessage(data);
                    } catch (e) {
                        console.error('Parse error:', e);
                    }
                };
                
                ws.onclose = () => {
                    addLog('WARN', 'WebSocket disconnected');
                    setOnline(false);
                    scheduleReconnect();
                };
                
                ws.onerror = (e) => {
                    console.error('WebSocket error:', e);
                };
            } catch (e) {
                addLog('ERROR', 'Failed to connect WebSocket');
                scheduleReconnect();
            }
        }
        
        function scheduleReconnect() {
            if (reconnectTimer) return;
            reconnectTimer = setTimeout(() => {
                reconnectTimer = null;
                connectWebSocket();
            }, 5000);
        }
        
        function handleMessage(data) {
            if (data.type === 'hello-ok') {
                addLog('INFO', `Connected to gateway v${data.server?.version || '?'}`);
                setOnline(true);
            } else if (data.type === 'event') {
                if (data.event === 'tick') {
                    // ÂøÉË∑≥ÔºåÂøΩÁï•
                } else if (data.event === 'presence') {
                    document.getElementById('clients').textContent = 
                        (data.payload?.length || 0).toString();
                } else {
                    addLog('INFO', `Event: ${data.event}`);
                }
            }
        }
        
        // ÂàùÂßãÂåñ
        updateStatus();
        setInterval(updateStatus, 30000);
        connectWebSocket();
    </script>
</body>
</html>
